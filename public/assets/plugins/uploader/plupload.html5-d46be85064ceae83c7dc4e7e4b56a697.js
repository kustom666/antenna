(function(e,t,n,r){function a(t,n){var i;return"FileReader"in e?(i=new FileReader,i.readAsDataURL(t),i.onload=function(){n(i.result)},void 0):n(t.getAsDataURL())}function o(t,n){var i;return"FileReader"in e?(i=new FileReader,i.readAsBinaryString(t),i.onload=function(){n(i.result)},void 0):n(t.getAsBinary())}function s(e,n,i,r){var o,s,d,f,c=this;a(g[e.id],function(a){o=t.createElement("canvas"),o.style.display="none",t.body.appendChild(o),s=o.getContext("2d"),d=new Image,d.onerror=d.onabort=function(){r({success:!1})},d.onload=function(){var t,g,h,p;if(n.width||(n.width=d.width),n.height||(n.height=d.height),f=Math.min(n.width/d.width,n.height/d.height),1>f||1===f&&"image/jpeg"===i){if(t=Math.round(d.width*f),g=Math.round(d.height*f),o.width=t,o.height=g,s.drawImage(d,0,0,t,g),"image/jpeg"===i){if(h=new l(atob(a.substring(a.indexOf("base64,")+7))),h.headers&&h.headers.length&&(p=new u,p.init(h.get("exif")[0])&&(p.setExif("PixelXDimension",t),p.setExif("PixelYDimension",g),h.set("exif",p.getBinary()),c.hasEventListener("ExifData")&&c.trigger("ExifData",e,p.EXIF()),c.hasEventListener("GpsData")&&c.trigger("GpsData",e,p.GPS()))),n.quality)try{a=o.toDataURL(i,n.quality/100)}catch(m){a=o.toDataURL(i)}}else a=o.toDataURL(i);a=a.substring(a.indexOf("base64,")+7),a=atob(a),h&&h.headers&&h.headers.length&&(a=h.restore(a),h.purge()),o.parentNode.removeChild(o),r({success:!0,data:a})}else r({success:!1})},d.src=a})}function d(){function e(e,t){var n,r=a?0:-8*(t-1),o=0;for(n=0;t>n;n++)o|=i.charCodeAt(e+n)<<Math.abs(r+8*n);return o}function t(e,t,n){var n=3===arguments.length?n:i.length-t-1;i=i.substr(0,t)+e+i.substr(n+t)}function n(e,n,i){var r,o="",s=a?0:-8*(i-1);for(r=0;i>r;r++)o+=String.fromCharCode(255&n>>Math.abs(s+8*r));t(o,e,i)}var i,a=!1;return{II:function(e){return e===r?a:(a=e,void 0)},init:function(e){a=!1,i=e},SEGMENT:function(e,n,r){switch(arguments.length){case 1:return i.substr(e,i.length-e-1);case 2:return i.substr(e,n);case 3:t(r,e,n);break;default:return i}},BYTE:function(t){return e(t,1)},SHORT:function(t){return e(t,2)},LONG:function(t,i){return i===r?e(t,4):(n(t,i,4),void 0)},SLONG:function(t){var n=e(t,4);return n>2147483647?n-4294967296:n},STRING:function(t,n){var i="";for(n+=t;n>t;t++)i+=String.fromCharCode(e(t,1));return i}}}function l(e){var t,n,i,a={65505:{app:"EXIF",name:"APP1",signature:"Exif\0"},65506:{app:"ICC",name:"APP2",signature:"ICC_PROFILE\0"},65517:{app:"IPTC",name:"APP13",signature:"Photoshop 3.0\0"}},o=[],s=r,u=0;if(t=new d,t.init(e),65496===t.SHORT(0)){for(n=2,i=Math.min(1048576,e.length);i>=n;)if(s=t.SHORT(n),s>=65488&&65495>=s)n+=2;else{if(65498===s||65497===s)break;u=t.SHORT(n+2)+2,a[s]&&t.STRING(n+4,a[s].signature.length)===a[s].signature&&o.push({hex:s,app:a[s].app.toUpperCase(),name:a[s].name.toUpperCase(),start:n,length:u,segment:t.SEGMENT(n,u)}),n+=u}return t.init(null),{headers:o,restore:function(e){t.init(e);var i=new l(e);if(!i.headers)return!1;for(var r=i.headers.length;r>0;r--){var a=i.headers[r-1];t.SEGMENT(a.start,a.length,"")}i.purge(),n=65504==t.SHORT(2)?4+t.SHORT(4):2;for(var r=0,s=o.length;s>r;r++)t.SEGMENT(n,0,o[r].segment),n+=o[r].length;return t.SEGMENT()},get:function(e){for(var t=[],n=0,i=o.length;i>n;n++)o[n].app===e.toUpperCase()&&t.push(o[n].segment);return t},set:function(e,t){var n=[];"string"==typeof t?n.push(t):n=t;for(var i=ii=0,r=o.length;r>i&&(o[i].app===e.toUpperCase()&&(o[i].segment=n[ii],o[i].length=n[ii].length,ii++),!(ii>=n.length));i++);},purge:function(){o=[],t.init(null)}}}}function u(){function e(e,t){var n,i,o,d,u,f,g,c,h=a.SHORT(e),p=[],m={};for(n=0;h>n;n++)if(g=f=e+12*n+2,o=t[a.SHORT(g)],o!==r){switch(d=a.SHORT(g+=2),u=a.LONG(g+=2),g+=4,p=[],d){case 1:case 7:for(u>4&&(g=a.LONG(g)+l.tiffHeader),i=0;u>i;i++)p[i]=a.BYTE(g+i);break;case 2:u>4&&(g=a.LONG(g)+l.tiffHeader),m[o]=a.STRING(g,u-1);continue;case 3:for(u>2&&(g=a.LONG(g)+l.tiffHeader),i=0;u>i;i++)p[i]=a.SHORT(g+2*i);break;case 4:for(u>1&&(g=a.LONG(g)+l.tiffHeader),i=0;u>i;i++)p[i]=a.LONG(g+4*i);break;case 5:for(g=a.LONG(g)+l.tiffHeader,i=0;u>i;i++)p[i]=a.LONG(g+4*i)/a.LONG(g+4*i+4);break;case 9:for(g=a.LONG(g)+l.tiffHeader,i=0;u>i;i++)p[i]=a.SLONG(g+4*i);break;case 10:for(g=a.LONG(g)+l.tiffHeader,i=0;u>i;i++)p[i]=a.SLONG(g+4*i)/a.SLONG(g+4*i+4);break;default:continue}c=1==u?p[0]:p,m[o]=s.hasOwnProperty(o)&&"object"!=typeof c?s[o][c]:c}return m}function t(){var t=r,n=l.tiffHeader;return a.II(18761==a.SHORT(n)),42!==a.SHORT(n+=2)?!1:(l.IFD0=l.tiffHeader+a.LONG(n+=2),t=e(l.IFD0,o.tiff),l.exifIFD="ExifIFDPointer"in t?l.tiffHeader+t.ExifIFDPointer:r,l.gpsIFD="GPSInfoIFDPointer"in t?l.tiffHeader+t.GPSInfoIFDPointer:r,!0)}function n(e,t,n){var r,s,d,u=0;if("string"==typeof t){var f=o[e.toLowerCase()];for(hex in f)if(f[hex]===t){t=hex;break}}for(r=l[e.toLowerCase()+"IFD"],s=a.SHORT(r),i=0;s>i;i++)if(d=r+12*i+2,a.SHORT(d)==t){u=d+8;break}return u?(a.LONG(u,n),!0):!1}var a,o,s,l={};return a=new d,o={tiff:{274:"Orientation",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}},s={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},{init:function(e){return l={tiffHeader:10},e!==r&&e.length?(a.init(e),65505===a.SHORT(0)&&"EXIF\0"===a.STRING(4,5).toUpperCase()?t():!1):!1},EXIF:function(){var t;return t=e(l.exifIFD,o.exif),t.ExifVersion&&(t.ExifVersion=String.fromCharCode(t.ExifVersion[0],t.ExifVersion[1],t.ExifVersion[2],t.ExifVersion[3])),t},GPS:function(){var t;return t=e(l.gpsIFD,o.gps),t.GPSVersionID&&(t.GPSVersionID=t.GPSVersionID.join(".")),t},setExif:function(e,t){return"PixelXDimension"!==e&&"PixelYDimension"!==e?!1:n("exif",e,t)},getBinary:function(){return a.SEGMENT()}}}var f,g={};n.runtimes.Html5=n.addRuntime("html5",{getFeatures:function(){var i,r,a,o,s,d;return r=a=s=d=!1,e.XMLHttpRequest&&(i=new XMLHttpRequest,a=!!i.upload,r=!(!i.sendAsBinary&&!i.upload)),r&&(o=!!(i.sendAsBinary||e.Uint8Array&&e.ArrayBuffer),s=!(!File||!File.prototype.getAsDataURL&&!e.FileReader||!o),d=!(!File||!(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice))),f=n.ua.safari&&n.ua.windows,{html5:r,dragdrop:function(){var e=t.createElement("div");return"draggable"in e||"ondragstart"in e&&"ondrop"in e}(),jpgresize:s,pngresize:s,multipart:s||!!e.FileReader||!!e.FormData,canSendBinary:o,cantSendBlobInFormData:!(!(n.ua.gecko&&e.FormData&&e.FileReader)||FileReader.prototype.readAsArrayBuffer),progress:a,chunks:d,multi_selection:!(n.ua.safari&&n.ua.windows),triggerDialog:n.ua.gecko&&e.FormData||n.ua.webkit}},init:function(i,r){function a(e){var t,r,a,o=[],s={};for(r=0;e.length>r;r++)t=e[r],s[t.name]||(s[t.name]=!0,a=n.guid(),g[a]=t,o.push(new n.File(a,t.fileName||t.name,t.fileSize||t.size)));o.length&&i.trigger("FilesAdded",o)}var d;return d=this.getFeatures(),d.html5?(i.bind("Init",function(e){var r,o,s,d,l,u,f,g=[],c=e.settings.filters,h=t.body;r=t.createElement("div"),r.id=e.id+"_html5_container",n.extend(r.style,{position:"absolute",background:i.settings.shim_bgcolor||"transparent",width:"100px",height:"100px",overflow:"hidden",zIndex:99999,opacity:i.settings.shim_bgcolor?"":0}),r.className="plupload html5",i.settings.container&&(h=t.getElementById(i.settings.container),"static"===n.getStyle(h,"position")&&(h.style.position="relative")),h.appendChild(r);e:for(s=0;c.length>s;s++)for(l=c[s].extensions.split(/,/),d=0;l.length>d;d++){if("*"===l[d]){g=[];break e}u=n.mimeTypes[l[d]],u&&g.push(u)}if(r.innerHTML='<input id="'+i.id+'_html5"  style="font-size:999px" type="file" accept="'+g.join(",")+'" '+(i.settings.multi_selection&&i.features.multi_selection?'multiple="multiple"':"")+" />",r.scrollTop=100,f=t.getElementById(i.id+"_html5"),e.features.triggerDialog?n.extend(f.style,{position:"absolute",width:"100%",height:"100%"}):n.extend(f.style,{cssFloat:"right",styleFloat:"right"}),f.onchange=function(){a(this.files),this.value=""},o=t.getElementById(e.settings.browse_button)){var p=e.settings.browse_button_hover,m=e.settings.browse_button_active,y=e.features.triggerDialog?o:r;p&&(n.addEvent(y,"mouseover",function(){n.addClass(o,p)},e.id),n.addEvent(y,"mouseout",function(){n.removeClass(o,p)},e.id)),m&&(n.addEvent(y,"mousedown",function(){n.addClass(o,m)},e.id),n.addEvent(t.body,"mouseup",function(){n.removeClass(o,m)},e.id)),e.features.triggerDialog&&n.addEvent(o,"click",function(n){t.getElementById(e.id+"_html5").click(),n.preventDefault()},e.id)}}),i.bind("PostInit",function(){var e=t.getElementById(i.settings.drop_element);if(e){if(f)return n.addEvent(e,"dragenter",function(){var r,o,s;r=t.getElementById(i.id+"_drop"),r||(r=t.createElement("input"),r.setAttribute("type","file"),r.setAttribute("id",i.id+"_drop"),r.setAttribute("multiple","multiple"),n.addEvent(r,"change",function(){a(this.files),n.removeEvent(r,"change",i.id),r.parentNode.removeChild(r)},i.id),e.appendChild(r)),o=n.getPos(e,t.getElementById(i.settings.container)),s=n.getSize(e),"static"===n.getStyle(e,"position")&&n.extend(e.style,{position:"relative"}),n.extend(r.style,{position:"absolute",display:"block",top:0,left:0,width:s.w+"px",height:s.h+"px",opacity:0})},i.id),void 0;n.addEvent(e,"dragover",function(e){e.preventDefault()},i.id),n.addEvent(e,"drop",function(e){var t=e.dataTransfer;t&&t.files&&a(t.files),e.preventDefault()},i.id)}}),i.bind("Refresh",function(e){var r,a,o,s,d;r=t.getElementById(i.settings.browse_button),r&&(a=n.getPos(r,t.getElementById(e.settings.container)),o=n.getSize(r),s=t.getElementById(i.id+"_html5_container"),n.extend(s.style,{top:a.y+"px",left:a.x+"px",width:o.w+"px",height:o.h+"px"}),i.features.triggerDialog&&("static"===n.getStyle(r,"position")&&n.extend(r.style,{position:"relative"}),d=parseInt(n.getStyle(r,"z-index"),10),isNaN(d)&&(d=0),n.extend(r.style,{zIndex:d}),n.extend(s.style,{zIndex:d-1})))}),i.bind("UploadFile",function(t,i){function r(e,t,n){var i;if(!File.prototype.slice)return(i=File.prototype.webkitSlice||File.prototype.mozSlice)?i.call(e,t,n):null;try{return e.slice(),e.slice(t,n)}catch(r){return e.slice(t,n-t)}}function a(a){function o(){function g(r){var a,u=0,f=new XMLHttpRequest,g=f.upload,E="----pluploadboundary"+n.guid(),F="--",b="\r\n",x="";if(g&&(g.onprogress=function(e){i.loaded=Math.min(i.size,l+e.loaded-u),t.trigger("UploadProgress",i)}),f.onreadystatechange=function(){var e,d;if(4==f.readyState){try{e=f.status}catch(u){e=0}if(e>=400)t.trigger("Error",{code:n.HTTP_ERROR,message:n.translate("HTTP Error."),file:i,status:e});else{if(h){if(d={chunk:s,chunks:h,response:f.responseText,status:e},t.trigger("ChunkUploaded",i,d),l+=y,d.cancelled)return i.status=n.FAILED,void 0;i.loaded=Math.min(i.size,(s+1)*m)}else i.loaded=i.size;t.trigger("UploadProgress",i),r=c=a=x=null,!h||++s>=h?(i.status=n.DONE,t.trigger("FileUploaded",i,{response:f.responseText,status:e})):o()}f=null}},t.settings.multipart&&d.multipart){if(p.name=i.target_name||i.name,f.open("post",v,!0),n.each(t.settings.headers,function(e,t){f.setRequestHeader(t,e)}),"string"!=typeof r&&e.FormData)return a=new FormData,n.each(n.extend(p,t.settings.multipart_params),function(e,t){a.append(t,e)}),a.append(t.settings.file_data_name,r),f.send(a),void 0;if("string"==typeof r){if(f.setRequestHeader("Content-Type","multipart/form-data; boundary="+E),n.each(n.extend(p,t.settings.multipart_params),function(e,t){x+=F+E+b+'Content-Disposition: form-data; name="'+t+'"'+b+b,x+=unescape(encodeURIComponent(e))+b}),S=n.mimeTypes[i.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",x+=F+E+b+'Content-Disposition: form-data; name="'+t.settings.file_data_name+'"; filename="'+unescape(encodeURIComponent(i.name))+'"'+b+"Content-Type: "+S+b+b+r+b+F+E+F+b,u=x.length-r.length,r=x,f.sendAsBinary)f.sendAsBinary(r);else if(d.canSendBinary){for(var D=new Uint8Array(r.length),I=0;r.length>I;I++)D[I]=255&r.charCodeAt(I);f.send(D.buffer)}return}}v=n.buildUrl(t.settings.url,n.extend(p,t.settings.multipart_params)),f.open("post",v,!0),f.setRequestHeader("Content-Type","application/octet-stream"),n.each(t.settings.headers,function(e,t){f.setRequestHeader(t,e)}),f.send(r)}var c,h,p,m,y,S,v=t.settings.url;i.status!=n.DONE&&i.status!=n.FAILED&&t.state!=n.STOPPED&&(p={name:i.target_name||i.name},u.chunk_size&&i.size>u.chunk_size&&(d.chunks||"string"==typeof a)?(m=u.chunk_size,h=Math.ceil(i.size/m),y=Math.min(m,i.size-s*m),c="string"==typeof a?a.substring(s*m,s*m+y):r(a,s*m,s*m+y),p.chunk=s,p.chunks=h):(y=i.size,c=a),"string"!=typeof c&&f&&d.cantSendBlobInFormData&&d.chunks&&t.settings.chunk_size?(f.onload=function(){g(f.result)},f.readAsBinaryString(c)):g(c))}var s=0,l=0,f="FileReader"in e?new FileReader:null;o()}var l,u=t.settings;l=g[i.id],d.jpgresize&&t.settings.resize&&/\.(png|jpg|jpeg)$/i.test(i.name)?s.call(t,i,t.settings.resize,/\.png$/i.test(i.name)?"image/png":"image/jpeg",function(e){e.success?(i.size=e.data.length,a(e.data)):a(l)}):!d.chunks&&d.jpgresize?o(l,a):a(l)}),i.bind("Destroy",function(e){var i,r,a=t.body,o={inputContainer:e.id+"_html5_container",inputFile:e.id+"_html5",browseButton:e.settings.browse_button,dropElm:e.settings.drop_element};for(i in o)r=t.getElementById(o[i]),r&&n.removeAllEvents(r,e.id);n.removeAllEvents(t.body,e.id),e.settings.container&&(a=t.getElementById(e.settings.container)),a.removeChild(t.getElementById(o.inputContainer))}),r({success:!0}),void 0):(r({success:!1}),void 0)}})})(window,document,plupload);