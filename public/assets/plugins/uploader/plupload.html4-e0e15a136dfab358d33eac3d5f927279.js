(function(e,t,i){function n(e){return t.getElementById(e)}i.runtimes.Html4=i.addRuntime("html4",{getFeatures:function(){return{multipart:!0,triggerDialog:i.ua.gecko&&e.FormData||i.ua.webkit}},init:function(r,o){r.bind("Init",function(o){function s(){var e,a,d,u;l=i.guid(),b.push(l),e=t.createElement("form"),e.setAttribute("id","form_"+l),e.setAttribute("method","post"),e.setAttribute("enctype","multipart/form-data"),e.setAttribute("encoding","multipart/form-data"),e.setAttribute("target",o.id+"_iframe"),e.style.position="absolute",a=t.createElement("input"),a.setAttribute("id","input_"+l),a.setAttribute("type","file"),a.setAttribute("accept",y),a.setAttribute("size",1),u=n(o.settings.browse_button),o.features.triggerDialog&&u&&i.addEvent(n(o.settings.browse_button),"click",function(e){a.click(),e.preventDefault()},o.id),i.extend(a.style,{width:"100%",height:"100%",opacity:0,fontSize:"999px"}),i.extend(e.style,{overflow:"hidden"}),d=o.settings.shim_bgcolor,d&&(e.style.background=d),h&&i.extend(a.style,{filter:"alpha(opacity=0)"}),i.addEvent(a,"change",function(t){var d,c=t.target,g=[];c.value&&(n("form_"+l).style.top="-1048575px",d=c.value.replace(/\\/g,"/"),d=d.substring(d.length,d.lastIndexOf("/")+1),g.push(new i.File(l,d)),o.features.triggerDialog?i.removeEvent(u,"click",o.id):i.removeAllEvents(e,o.id),i.removeEvent(a,"change",o.id),s(),g.length&&r.trigger("FilesAdded",g))},o.id),e.appendChild(a),p.appendChild(e),o.refresh()}function a(){var n=t.createElement("div");n.innerHTML='<iframe id="'+o.id+'_iframe" name="'+o.id+'_iframe" src="'+v+':&quot;&quot;" style="display:none"></iframe>',d=n.firstChild,p.appendChild(d),i.addEvent(d,"load",function(t){var n,r,s=t.target;if(u){try{n=s.contentWindow.document||s.contentDocument||e.frames[s.id].document}catch(a){return o.trigger("Error",{code:i.SECURITY_ERROR,message:i.translate("Security error."),file:u}),void 0}r=n.body.innerHTML,r&&(u.status=i.DONE,u.loaded=1025,u.percent=100,o.trigger("UploadProgress",u),o.trigger("FileUploaded",u,{response:r}))}},o.id)}var d,u,l,c,g,m,f,p=t.body,v="javascript",b=[],h=/MSIE/.test(navigator.userAgent),y=[],_=o.settings.filters;e:for(c=0;_.length>c;c++)for(g=_[c].extensions.split(/,/),f=0;g.length>f;f++){if("*"===g[f]){y=[];break e}m=i.mimeTypes[g[f]],m&&y.push(m)}y=y.join(","),o.settings.container&&(p=n(o.settings.container),"static"===i.getStyle(p,"position")&&(p.style.position="relative")),o.bind("UploadFile",function(e,r){var o,s;r.status!=i.DONE&&r.status!=i.FAILED&&e.state!=i.STOPPED&&(o=n("form_"+r.id),s=n("input_"+r.id),s.setAttribute("name",e.settings.file_data_name),o.setAttribute("action",e.settings.url),i.each(i.extend({name:r.target_name||r.name},e.settings.multipart_params),function(e,n){var r=t.createElement("input");i.extend(r,{type:"hidden",name:n,value:e}),o.insertBefore(r,o.firstChild)}),u=r,n("form_"+l).style.top="-1048575px",o.submit(),o.parentNode.removeChild(o))}),o.bind("FileUploaded",function(e){e.refresh()}),o.bind("StateChanged",function(t){t.state==i.STARTED&&a(),t.state==i.STOPPED&&e.setTimeout(function(){i.removeEvent(d,"load",t.id),d.parentNode&&d.parentNode.removeChild(d)},0)}),o.bind("Refresh",function(e){var r,o,s,a,d,u,c,g,m;r=n(e.settings.browse_button),r&&(d=i.getPos(r,n(e.settings.container)),u=i.getSize(r),c=n("form_"+l),g=n("input_"+l),i.extend(c.style,{top:d.y+"px",left:d.x+"px",width:u.w+"px",height:u.h+"px"}),e.features.triggerDialog&&("static"===i.getStyle(r,"position")&&i.extend(r.style,{position:"relative"}),m=parseInt(r.style.zIndex,10),isNaN(m)&&(m=0),i.extend(r.style,{zIndex:m}),i.extend(c.style,{zIndex:m-1})),s=e.settings.browse_button_hover,a=e.settings.browse_button_active,o=e.features.triggerDialog?r:c,s&&(i.addEvent(o,"mouseover",function(){i.addClass(r,s)},e.id),i.addEvent(o,"mouseout",function(){i.removeClass(r,s)},e.id)),a&&(i.addEvent(o,"mousedown",function(){i.addClass(r,a)},e.id),i.addEvent(t.body,"mouseup",function(){i.removeClass(r,a)},e.id)))}),r.bind("FilesRemoved",function(e,t){var i,r;for(i=0;t.length>i;i++)r=n("form_"+t[i].id),r&&r.parentNode.removeChild(r)}),r.bind("Destroy",function(e){var r,o,s,a={inputContainer:"form_"+l,inputFile:"input_"+l,browseButton:e.settings.browse_button};for(r in a)o=n(a[r]),o&&i.removeAllEvents(o,e.id);i.removeAllEvents(t.body,e.id),i.each(b,function(e){s=n("form_"+e),s&&p.removeChild(s)})}),s()}),o({success:!0})}})})(window,document,plupload);